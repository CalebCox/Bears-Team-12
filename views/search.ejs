<% include ./partials/header %>

<main>
    <section class="search">

      <p class="search-title"> Search <i class="fas fa-search"></i></p>
      <form action="search" method="GET">
        <label class="input-label">Lost or Found</label>
        <select class="input search-type" name="postType">
          <option value="" >Both</option>
          <option value="LOST" <%= query && query.postType === 'LOST' ? 'selected' : '' %>>Lost Pets</option>
          <option value="FOUND" <%= query && query.postType === 'FOUND' ? 'selected' : '' %>>Found Pets</option>
        </select>
        <label class="input-label">Pet Type:</label>
        <select class="input search-type" name="petType">
          <option class="input" value="" >All Types</option>
          <option value="Dog" <%= query && query.petType === 'Dog' ? 'selected' : '' %> >Dog</option>
          <option value="Cat" <%= query && query.petType === 'Cat' ? 'selected' : '' %> >Cat</option>
          <option value="Bird" <%= query && query.petType === 'Bird' ? 'selected' : '' %> >Bird</option>
          <option value="Reptile" <%= query && query.petType === 'Reptile' ? 'selected' : '' %> >Reptile</option>
          <option value="Other" <%= query && query.petType === 'Other' ? 'selected' : '' %> >Other</option>
        </select>
  
        <label class="input-label">Zip Code:</label>
        <input class="input search-location" type="text" name="zipCode" 
          placeholder="Please enter a zipcode" value="<%= query ? query.zipCode : ''%>"
          pattern="[0-9]{5}"
        >
        </input>
  
        <label class="input-label">Name:</label>
        <input class="input search-name" type="text" name="petName" 
          placeholder="Please enter the Pet Name" value="<%= query ? query.petName : ''%>"
        >
        </input>
  
        <button id="submit" class="form-btn">Submit</button>
    </form>
    </section>
    
    <section class="pet-list">
    <% if( firstRun ){ %>
      <p class="search-title"> Please select search options from above</i></p>
    <% } %>
    <% if( searchResults ) { %>
        <p class="search-title"> <%= searchResults.length %> Results Found</i></p>
      <% searchResults.forEach( (result, idx, array) => { %>
        <a class="pet-link" href="/posts/<%= result.postType.toLowerCase() %>pet/<%= result._id %>">
          <div class="pet">
              <div class="pet-image-area">
                <img class="pet-image" src="<%= result.image %>" alt="<%= result.petType.petCategory %>">
              </div>
              <div class="details-area">
                <% if (result.postType === 'LOST' && result.lost.name !== '') { %>
                  <h2 class="pet-name"><%= result.lost.name %></h2>
                <% } else if (result.postType === 'LOST' && result.lost.name === '')  { %>
                  <h2 class="pet-name"><%= result.title %></h2>
                <% } else if (result.postType === 'FOUND' && result.found.name !== '') { %>
                  <h2 class="pet-name"><%= result.found.name %></h2>
                <% } else if (result.postType === 'FOUND' && result.found.name === '')  { %>
                  <h2 class="pet-name"><%= result.title %></h2>
                <% } %>
                <p class="info">Type: <span class="detail"><%= result.petType.petCategory %></span></p>
                <p class="info">Color: <span class="detail"><%= result.breed %></span></p>
                <% if (result.postType === 'LOST') { %>
                  <p class="info">Last seen: <span class="detail"><%= result.location.city %>, <%= result.location.state %>, <%= result.location.postal %></span></p>
                <% } else if (result.postType === 'FOUND') { %>
                  <p class="info">Found  Near: <span class="detail"><%= result.location.city %>, <%= result.location.state %>, <%= result.location.postal %></span></p>
                <% } %>
                <p class="info">Date: <span class="detail"><%= result.date %></span></p>
                <p class="info">About: <span class="detail desc"><%= result.description %></span></p>
              </div>
          </div>
        </a>
        <% if (idx === array.length - 1) { %>
          <!-- do nothing -->
        <% } else { %>
          <hr class="line">
        <% } %>
      <% }) %>
    <% } else { %>
      <% if( !firstRun ){ %>
        <p class="search-title"> 0 Results Found</i></p>
      <% } %>
    <% } %>
    
    </section>
    

  </main>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script type="text/javascript" src="../recent.js"></script>
<% include ./partials/footer %>